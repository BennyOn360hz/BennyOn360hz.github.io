<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dash Fan Game</title>
<style>
body{margin:0;overflow:hidden;background:#050510;font-family:sans-serif}
canvas{display:block}
button{font-size:18px;padding:10px;margin:5px}
#menu,#editorUI{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:white;text-align:center}
#editorUI{top:10px;left:10px;transform:none}
</style>
</head>
<body>

<canvas id="c"></canvas>

<div id="menu">
<h1>Dash Fan Game</h1>
<button onclick="startGame()">Play</button>
<button onclick="startEditor()">Level Editor</button>
</div>

<div id="editorUI" style="display:none">
<button onclick="tool='block'">Block</button>
<button onclick="tool='spike'">Spike</button>
<button onclick="saveLevel()">Save</button>
<button onclick="loadLevel()">Load</button>
<button onclick="exitEditor()">Exit</button>
</div>

<script>
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;
onresize=()=>{canvas.width=innerWidth;canvas.height=innerHeight}

let state="menu";
let level=[];
let tool="block";
let progress=0;
let speed=6;
let gravity=0.8;
let jump=-13;
let gameOver=false;

const player={x:150,y:200,size:25,vy:0};

function ground(){return canvas.height-80}

function startGame(){
 state="game";
 document.getElementById("menu").style.display="none";
}
function startEditor(){
 state="editor";
 document.getElementById("menu").style.display="none";
 document.getElementById("editorUI").style.display="block";
}
function exitEditor(){
 document.getElementById("editorUI").style.display="none";
 document.getElementById("menu").style.display="block";
 state="menu";
}

addEventListener("keydown",e=>{
 if(e.code==="Space"){
  if(state==="game"){
   if(player.y>=ground()-player.size)player.vy=jump;
   if(gameOver)reset();
  }
 }
});

canvas.addEventListener("mousedown",e=>{
 if(state==="editor"){
  let x=e.clientX+progress;
  let y=e.clientY;
  level.push({x,y,type:tool});
 }
});

function saveLevel(){
 localStorage.setItem("dashLevel",JSON.stringify(level));
 alert("Level saved");
}
function loadLevel(){
 let data=localStorage.getItem("dashLevel");
 if(data)level=JSON.parse(data);
}

function reset(){
 progress=0;
 player.y=200;
 player.vy=0;
 gameOver=false;
}

function collide(o){
 return player.x+player.size>o.x-progress &&
        player.x<o.x-progress+40 &&
        player.y+player.size>o.y &&
        player.y<o.y+40;
}

function drawNeon(x,y,w,h,color){
 ctx.shadowBlur=15;
 ctx.shadowColor=color;
 ctx.fillStyle=color;
 ctx.fillRect(x,y,w,h);
 ctx.shadowBlur=0;
}

function update(){
 ctx.fillStyle="#070716";
 ctx.fillRect(0,0,canvas.width,canvas.height);

 if(state==="game"){
  progress+=speed;

  player.vy+=gravity;
  player.y+=player.vy;
  if(player.y>ground()-player.size){
   player.y=ground()-player.size;
   player.vy=0;
  }

  drawNeon(player.x,player.y,player.size,player.size,"cyan");

  ctx.fillStyle="#0ff";
  ctx.fillRect(0,ground(),canvas.width,80);

  level.forEach(o=>{
   let x=o.x-progress;
   if(o.type==="block"){
    drawNeon(x,o.y,40,40,"cyan");
    if(collide(o))gameOver=true;
   }
   if(o.type==="spike"){
    ctx.fillStyle="red";
    ctx.beginPath();
    ctx.moveTo(x,o.y+40);
    ctx.lineTo(x+20,o.y);
    ctx.lineTo(x+40,o.y+40);
    ctx.fill();
    if(collide(o))gameOver=true;
   }
  });

  let p=Math.min(progress/2000,1);
  ctx.fillStyle="#0ff";
  ctx.fillRect(0,0,canvas.width*p,8);

  if(gameOver){
   ctx.fillStyle="white";
   ctx.font="40px sans-serif";
   ctx.fillText("CLICK TO RESTART",canvas.width/2-200,canvas.height/2);
  }
 }

 if(state==="editor"){
  ctx.fillStyle="#0ff";
  ctx.fillRect(0,ground(),canvas.width,80);
  level.forEach(o=>{
   if(o.type==="block")drawNeon(o.x-progress,o.y,40,40,"cyan");
   if(o.type==="spike"){
    ctx.fillStyle="red";
    ctx.beginPath();
    ctx.moveTo(o.x-progress,o.y+40);
    ctx.lineTo(o.x-progress+20,o.y);
    ctx.lineTo(o.x-progress+40,o.y+40);
    ctx.fill();
   }
  });
 }

 requestAnimationFrame(update);
}
update();
</script>
</body>
</html>
